user root;
worker_processes auto;
pid /run/nginx.pid;

include /etc/nginx/modules-enabled/*.conf;

events {
	worker_connections 1024;
}

http {

  server {
    listen 4000;
    server_name backend;

    location / {
      resolver 172.0.0.11 valid=30s;
      set $upstream_hercules hercules;
      proxy_pass http://$upstream_hercules:4000;
      proxy_set_header    X-Forwarded-For $remote_addr;
    }
  }

  server {
    listen 3000;
    server_name grafana;

    location / {
      resolver 172.0.0.1 valid=30s;
      set $upstream_grafana grafana;
      proxy_pass          http://$upstream_grafana:3000;
      proxy_set_header    Host $http_host;
    }
  }

  server {
    listen 3100;
    server_name loki;

    location / {
      resolver 172.0.0.1 valid=30s;
      set $upstream_loki loki;
      proxy_pass          http://$upstream_loki:3100;
      proxy_set_header    X-Forwarded-For $remote_addr;
    }
  }


  server {
    listen 5601;
    server_name kibana;

    location / {
      resolver 172.0.0.1 valid=30s;
      set $upstream_kibana kibana;
      proxy_pass          http://$upstream_kibana:5601;
      proxy_set_header    X-Forwarded-For $remote_addr;
    }
  }

  server {
    listen 8081;
    server_name nginx;

    location = /stub_status {
      stub_status;
    }
  }
}
